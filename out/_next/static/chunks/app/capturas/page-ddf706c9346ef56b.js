(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{4664:function(e,t,a){Promise.resolve().then(a.bind(a,9842))},9842:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var s=a(7437),i=a(2265),r=a(3531),n=a(1550),l=a(3524),d=a(1706),c=a(2929),o=a(9186),x=a(5838),m=a(2893),p=a(6263),u=a(5925);let g={delivery:"Entrega",signature:"Firma",document:"Albar\xe1n",return:"Devoluci\xf3n",incident:"Incidente"},h={pending:"Pendiente",verified:"Entregado",rejected:"Con incidencia",incomplete:"Incompleto"};var j=a(96);function w(){let[e,t]=(0,i.useState)(null),[a,w]=(0,i.useState)(!0),[f,v]=(0,i.useState)("all"),[y,N]=(0,i.useState)("all"),[b,D]=(0,i.useState)(null);(0,i.useEffect)(()=>{S()},[f,y]);let S=async()=>{try{w(!0),await new Promise(e=>setTimeout(e,300));let e=[...j.$];"all"!==f&&(e=e.filter(e=>e.status===f)),"all"!==y&&(e=e.filter(e=>e.type===y));let a=new Date,s=new Date(a.getTime()-6048e5),i={total:j.$.length,pending:j.$.filter(e=>"pending"===e.status).length,verified:j.$.filter(e=>"verified"===e.status).length,rejected:j.$.filter(e=>"rejected"===e.status).length,incomplete:j.$.filter(e=>"incomplete"===e.status).length,todayCount:j.$.filter(e=>new Date(e.capturedAt).toDateString()===a.toDateString()).length,weekCount:j.$.filter(e=>new Date(e.capturedAt)>=s).length};t({captures:e,stats:i})}catch(e){console.error("Error fetching captures:",e),u.ZP.error("Error al cargar las capturas")}finally{w(!1)}},A=async(e,t,a)=>{try{await new Promise(e=>setTimeout(e,300));let s=j.$.findIndex(t=>t.id===e);if(-1===s)throw Error("Capture not found");let i={...j.$[s],status:t,updatedAt:new Date().toISOString()};"verified"===t?(i.verifiedBy="Admin",i.verifiedAt=new Date().toISOString()):"rejected"===t&&a&&(i.rejectionReason=a,i.verifiedBy="Admin",i.verifiedAt=new Date().toISOString()),j.$[s]=i,u.ZP.success("Captura ".concat("verified"===t?"marcada como entregada":"incomplete"===t?"marcada como incompleta":"marcada con incidencia")),S(),D(null)}catch(e){console.error("Error updating capture:",e),u.ZP.error("Error al actualizar la captura")}},I=e=>{switch(e){case"delivery":return(0,s.jsx)(r.Z,{className:"h-4 w-4"});case"signature":case"document":return(0,s.jsx)(n.Z,{className:"h-4 w-4"});default:return(0,s.jsx)(l.Z,{className:"h-4 w-4"})}},O=e=>{switch(e){case"verified":return"badge-delivered";case"pending":return"badge-pending";case"rejected":return"badge-failed";case"incomplete":return"badge-incomplete";default:return""}};return a&&!e?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-20 lg:pb-0",children:[(0,s.jsx)("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-40",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Gesti\xf3n de Capturas"}),(0,s.jsx)("div",{className:"flex items-center space-x-2",children:(0,s.jsx)("button",{onClick:()=>S(),className:"p-2 text-gray-500 hover:text-gray-700 rounded-lg hover:bg-gray-100",disabled:a,children:(0,s.jsx)(d.Z,{className:"h-5 w-5 ".concat(a?"animate-spin":"")})})})]})})}),(0,s.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(r.Z,{className:"h-5 w-5 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Total"}),(0,s.jsx)("p",{className:"text-lg font-bold text-gray-900",children:(null==e?void 0:e.stats.total)||0})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.Z,{className:"h-5 w-5 text-yellow-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Pendientes"}),(0,s.jsx)("p",{className:"text-lg font-bold text-yellow-600",children:(null==e?void 0:e.stats.pending)||0})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(o.Z,{className:"h-5 w-5 text-green-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Entregados"}),(0,s.jsx)("p",{className:"text-lg font-bold text-green-600",children:(null==e?void 0:e.stats.verified)||0})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(x.Z,{className:"h-5 w-5 text-orange-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Incompletos"}),(0,s.jsx)("p",{className:"text-lg font-bold text-orange-600",children:(null==e?void 0:e.stats.incomplete)||0})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m.Z,{className:"h-5 w-5 text-red-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Con incidencia"}),(0,s.jsx)("p",{className:"text-lg font-bold text-red-600",children:(null==e?void 0:e.stats.rejected)||0})]})]})]})})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-4",children:(0,s.jsx)("div",{className:"p-2",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,s.jsx)("div",{className:"flex space-x-1",children:["all","pending","incomplete"].map(e=>(0,s.jsx)("button",{onClick:()=>v(e),className:"flex-1 py-2 px-2 rounded-lg text-xs font-medium transition-colors ".concat(f===e?"bg-primary-600 text-white":"text-gray-700 hover:bg-gray-100"),children:"all"===e?"Todas":"pending"===e?"Pendientes":"Incompletos"},e))}),(0,s.jsx)("div",{className:"flex space-x-1 overflow-x-auto",children:["all","delivery","return","incident"].map(e=>(0,s.jsx)("button",{onClick:()=>N(e),className:"flex-shrink-0 py-2 px-3 rounded-lg text-xs font-medium transition-colors ".concat(y===e?"bg-primary-600 text-white":"text-gray-700 hover:bg-gray-100"),children:"all"===e?"Todos":g[e]},e))})]})})}),(0,s.jsx)("div",{className:"space-y-3",children:null==e?void 0:e.captures.map(e=>(0,s.jsx)("div",{className:"card-base p-3 sm:p-4 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>D(e),children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsxs)("div",{className:"relative w-16 h-16 sm:w-20 sm:h-20 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:[(0,s.jsx)("img",{src:e.thumbnailUrl||e.imageUrl,alt:"Captura ".concat(e.id),className:"w-full h-full object-cover"}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 hover:bg-opacity-20 transition-all",children:(0,s.jsx)(l.Z,{className:"h-6 w-6 text-white opacity-0 hover:opacity-100"})})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)("span",{className:"text-sm font-semibold text-gray-900",children:["#",e.id]}),(0,s.jsx)("span",{className:"badge-base text-xs ".concat(O(e.status)),children:h[e.status]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-1 text-gray-500",children:[I(e.type),(0,s.jsx)("span",{className:"text-xs hidden sm:inline",children:g[e.type]})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-gray-600 mb-1",children:[(0,s.jsxs)("span",{children:["Pedido: ",e.orderId]}),e.order&&(0,s.jsx)("span",{className:"truncate max-w-[150px] sm:max-w-none",children:e.order.clientName})]}),e.location&&(0,s.jsxs)("div",{className:"flex items-start space-x-1 text-xs text-gray-500 mb-1",children:[(0,s.jsx)(p.Z,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{className:"line-clamp-1",children:e.location.address})]}),e.notes&&(0,s.jsx)("p",{className:"text-xs text-gray-500 line-clamp-1 mb-1",children:e.notes}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:new Date(e.capturedAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}),e.verifiedBy&&(0,s.jsxs)("span",{className:"text-xs text-gray-400",children:["Verificado por ",e.verifiedBy]})]})]})]})},e.id))}),(null==e?void 0:e.captures.length)===0&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(r.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No hay capturas"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"No se encontraron capturas con los filtros seleccionados"})]})]}),b&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>D(null),children:(0,s.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Captura #",b.id]}),(0,s.jsx)("button",{onClick:()=>D(null),className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,s.jsx)(m.Z,{className:"h-5 w-5 text-gray-500"})})]})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("img",{src:b.imageUrl,alt:"Captura ".concat(b.id),className:"w-full rounded-lg"})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Tipo"}),(0,s.jsx)("p",{className:"font-medium",children:g[b.type]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Estado"}),(0,s.jsx)("span",{className:"badge-base ".concat(O(b.status)),children:h[b.status]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Pedido"}),(0,s.jsx)("p",{className:"font-medium",children:b.orderId})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Capturado por"}),(0,s.jsx)("p",{className:"font-medium",children:b.capturedBy})]})]}),b.location&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Ubicaci\xf3n"}),(0,s.jsx)("p",{className:"font-medium",children:b.location.address})]}),b.notes&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Notas"}),(0,s.jsx)("p",{className:"font-medium",children:b.notes})]}),b.rejectionReason&&(0,s.jsxs)("div",{className:"p-3 bg-red-50 rounded-lg",children:[(0,s.jsx)("p",{className:"text-xs text-red-600 font-medium",children:"Detalle de incidencia"}),(0,s.jsx)("p",{className:"text-sm text-red-800",children:b.rejectionReason})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Fecha de captura"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(b.capturedAt).toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),b.verifiedAt&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Verificado"}),(0,s.jsxs)("p",{className:"font-medium",children:[new Date(b.verifiedAt).toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})," por ",b.verifiedBy]})]})]}),"pending"===b.status&&(0,s.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)("button",{onClick:()=>A(b.id,"verified"),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[(0,s.jsx)(o.Z,{className:"h-5 w-5 inline mr-2"}),"Entregado"]}),(0,s.jsxs)("button",{onClick:()=>A(b.id,"incomplete"),className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:[(0,s.jsx)(x.Z,{className:"h-5 w-5 inline mr-2"}),"Incompleto"]})]}),(0,s.jsxs)("button",{onClick:()=>{let e=prompt("Detalle de la incidencia:");e&&A(b.id,"rejected",e)},className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:[(0,s.jsx)(m.Z,{className:"h-5 w-5 inline mr-2"}),"Reportar Incidencia"]})]})]})]})})]})}},96:function(e,t,a){"use strict";a.d(t,{$:function(){return s}});let s=[{id:"CAP-001",orderId:"ORD-003",type:"delivery",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/100/75",status:"verified",location:{latitude:23.1136,longitude:-82.3666,address:"Vedado, La Habana"},notes:"Entrega exitosa en puerta principal",capturedBy:"Juan P\xe9rez",capturedAt:new Date(Date.now()-864e5).toISOString(),verifiedBy:"Admin",verifiedAt:new Date(Date.now()-72e6).toISOString(),createdAt:new Date(Date.now()-864e5).toISOString(),updatedAt:new Date(Date.now()-72e6).toISOString()},{id:"CAP-002",orderId:"ORD-010",type:"signature",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/100/75",status:"verified",location:{latitude:23.1336,longitude:-82.3836,address:"Miramar, La Habana"},notes:"Firma del cliente confirmada",capturedBy:"Juan P\xe9rez",capturedAt:new Date(Date.now()-2592e5).toISOString(),verifiedBy:"Admin",verifiedAt:new Date(Date.now()-252e6).toISOString(),createdAt:new Date(Date.now()-2592e5).toISOString(),updatedAt:new Date(Date.now()-252e6).toISOString()},{id:"CAP-003",orderId:"ORD-001",type:"document",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/100/75",status:"pending",location:{latitude:23.0511,longitude:-82.3452,address:"Centro Habana, La Habana"},notes:"Albar\xe1n pendiente de verificaci\xf3n",capturedBy:"Juan P\xe9rez",capturedAt:new Date(Date.now()-72e5).toISOString(),createdAt:new Date(Date.now()-72e5).toISOString(),updatedAt:new Date(Date.now()-72e5).toISOString()},{id:"CAP-004",orderId:"ORD-002",type:"delivery",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/100/75",status:"pending",location:{latitude:23.1036,longitude:-82.4066,address:"Playa, La Habana"},notes:"Foto de paquete en puerta",capturedBy:"Juan P\xe9rez",capturedAt:new Date(Date.now()-144e5).toISOString(),createdAt:new Date(Date.now()-144e5).toISOString(),updatedAt:new Date(Date.now()-144e5).toISOString()},{id:"CAP-005",orderId:"ORD-005",type:"incident",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/100/75",status:"rejected",location:{latitude:23.0811,longitude:-82.4552,address:"Marianao, La Habana"},notes:"Direcci\xf3n incorrecta",rejectionReason:"Imagen borrosa, no se puede verificar la entrega correctamente",capturedBy:"Juan P\xe9rez",capturedAt:new Date(Date.now()-1728e5).toISOString(),verifiedBy:"Admin",verifiedAt:new Date(Date.now()-144e6).toISOString(),createdAt:new Date(Date.now()-1728e5).toISOString(),updatedAt:new Date(Date.now()-144e6).toISOString()},{id:"CAP-006",orderId:"ORD-004",type:"return",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/100/75",status:"verified",location:{latitude:23.0236,longitude:-82.3966,address:"Cerro, La Habana"},notes:"Devoluci\xf3n - Cliente rechaz\xf3 el paquete",capturedBy:"Juan P\xe9rez",capturedAt:new Date(Date.now()-1296e5).toISOString(),verifiedBy:"Admin",verifiedAt:new Date(Date.now()-108e6).toISOString(),createdAt:new Date(Date.now()-1296e5).toISOString(),updatedAt:new Date(Date.now()-108e6).toISOString()},{id:"CAP-007",orderId:"ORD-006",type:"document",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/100/75",status:"pending",location:{latitude:23.1236,longitude:-82.3466,address:"Plaza de la Revoluci\xf3n, La Habana"},notes:"Albar\xe1n de entrega parcial",capturedBy:"Juan P\xe9rez",capturedAt:new Date(Date.now()-216e5).toISOString(),createdAt:new Date(Date.now()-216e5).toISOString(),updatedAt:new Date(Date.now()-216e5).toISOString()},{id:"CAP-008",orderId:"ORD-007",type:"delivery",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/100/75",status:"pending",location:{latitude:23.0936,longitude:-82.3366,address:"Habana Vieja, La Habana"},notes:"Entrega express completada",capturedBy:"Juan P\xe9rez",capturedAt:new Date(Date.now()-36e5).toISOString(),createdAt:new Date(Date.now()-36e5).toISOString(),updatedAt:new Date(Date.now()-36e5).toISOString()}];s.push({id:"CAP-009",orderId:"ORD-008",type:"delivery",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/100/75",status:"incomplete",location:{latitude:23.1436,longitude:-82.3566,address:"Nuevo Vedado, La Habana"},notes:"Entrega parcial - faltan 2 items",capturedBy:"Juan P\xe9rez",capturedAt:new Date(Date.now()-288e5).toISOString(),createdAt:new Date(Date.now()-288e5).toISOString(),updatedAt:new Date(Date.now()-288e5).toISOString()}),s.filter(e=>"pending"===e.status).length,s.filter(e=>"verified"===e.status).length,s.filter(e=>"rejected"===e.status).length,s.filter(e=>"incomplete"===e.status).length}},function(e){e.O(0,[974,971,938,744],function(){return e(e.s=4664)}),_N_E=e.O()}]);